# 10 保持连接
------
所有通讯端点需要为每个媒体数据会话发送保持连接信息。这些保持连接消息可以保持NAT绑定的存活以支持媒体会话。这些保持连接消息不论媒体流当前是不活动或是只发送或是只接收
或是双工通讯，也不论当前带宽属性如何都必须进行发送。这些保持连接消息即使在ICE还没有为对话初始化时也必须发出。保持连接消息应该是对端支持的格式下发送。ICE端点允许
为UDP流进行STUN-based保持连接，因此，STUN保持连接必须在一个端点是完全ICE实现并且通讯对端也支持ICE（无论完全或简化实现）时使用。端点可以通过每个媒体会话的
a=candidate属性知晓对端的ICE支持情况。如果对端不支持ICE，那么保持连接的通讯格式选择就是一个本地实现。建议是一种可以在媒体数据之外简单实现的方式。比如RPT NO-OP
[NO-OP-RTP]，以及如果双方都支持时的RTP Comfort Noise(RFC3389)。如果端点无法支持一个很好的保持连接通讯，端点应该发送带有一个不正常版本数字的RTP包，
或者其他形式的错误提醒以提示对端丢弃这些数据包。

如果ICE的媒体组件上正在使用的候选对有Tr秒没有发送任何数据包(包括组件上的媒体数据包和前面的保持连接数据包), 端点必须为这个候选对生成一个保持连接消息。Tr这个值应该
可以被配置，默认应该是15秒。Tr不能被配置为15秒以下。如果端点有能力可以动态的得到通讯中间的NAT绑定的剩余时间，可以设置这个值为Tr。管理员部署ICE在多个受约束的
网络环境时，应该把Tr设置为环境中最长的可能时段。

如果STUN被用来做保持连接，STUN绑定指示会被使用(RFC5389)。绑定指示不能使用任何验证机制。它应该包含FINGERPRINT属性来做解复用，但不应包含其他任何属性。
绑定指示会在媒体数据使用的本地候选和远程候选上发送。虽然绑定指示是用来保持连接，但端点也必须为接受连接检查做好准备。如果收到了连接检查，应该照RFC5389生成响应，
这不会对ICE处理有任何影响。
端点必须在ICE为媒体数据通信选择了候选对，或者一开始媒体数据开始流动时，就开始保持连接处理。保持连接会在通讯会话终止或是媒体流被移除时停止。

























 




